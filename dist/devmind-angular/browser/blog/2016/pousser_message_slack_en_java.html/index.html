<!DOCTYPE html><html lang="en" data-critters-container><head>
  <meta charset="utf-8">
  <title>Blog</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      min-height: 100vh;
      max-height: 100vh;
      font-family: "Helvetica", "Arial", "sans-serif";
      padding: 0;
      margin: 0;
    }

    header {
      height: 90px;
      max-height: 90px;
      box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      background-color: white;
      display: -webkit-flex;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      z-index: 99;
      transition-duration: 0.2s;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-property: max-height, box-shadow;
      position: fixed;
      width: 100%;
      text-align: center;
    }
    header hr {
      width:100%;
      background-color: #424242;
      border-color: #424242;
      display: block;
      border: 0;
      height: 0.5em;
      margin: 0;
    }
    .header-img {
      margin: auto;
      width: 50%;
      padding-top: 0.5em;
      height: 30px;
    }
    .header-img img {
      max-height: 30px !important;
    }
    .header-space {
      min-height: 90px;
    }


    @media screen and (min-width: 901px) {
      header {
        height: 120px;
        max-height: 120px;
      }
      .header-img {
        height: 60px;
      }
      .header-img img {
        max-height: 60px !important;
      }
      .header-space {
        min-height: 120px;
      }
      nav a {
        padding: 6px 24px;
      }
      .nav-home{
        display: block !important;
      }
    }


    nav {
      display: -webkit-flex;
      display: flex;
      margin: auto;
    }

    nav a {
      padding: 0 12px;
      line-height: 28px;
      height: 28px;
      color: #424242;
      margin: auto;
      text-decoration: none;
      text-transform: uppercase;
      font-weight: 600;
      font-size: 13px;
      border-radius: 4px;
    }
    .nav-home{
      display: none;
    }
    nav a > img {
    // height: 20px;
    }

    nav a:hover {
      background-color: #9e9e9e;
    }

    nav .active {
      background-color: rgba(0, 0, 0, 0.14);
    }

    main {
      overflow-x: hidden;
    }

    img, picture {
      max-width: 100%;
      height: auto;
      margin: auto;
    }

    * {
      box-sizing: border-box; /* pour maîtriser width et flex-basis */
    }

    .devmind-section {
      display: block;
      margin: 0 auto;
      max-width: 1600px;
      padding: 60px 40px;
    }

    @media (max-width: 700px) {
      .devmind-section {
        padding: 25px 10px;
      }
    }

    @media (min-width: 701px) and (max-width: 900px) {
      .devmind-section {
        padding: 40px 25px;
      }
    }

    .dm-social {
      min-width: 2em;
      max-width: 2em;
      width: 2em;
      height: 2em;
    }
  </style>
  <script>
    function copyToClipboard(id) {
      const text = document.getElementById(id).innerText
        .replaceAll('~$', '')
        .replaceAll('(1)', '')
        .replaceAll('(2)', '')
        .replaceAll('(3)', '')
        .replaceAll('(4)', '')
        .replaceAll('(5)', '')
        .replaceAll('(6)', '')
        .replaceAll('(7)', '')
        .replaceAll('(8)', '')
        .replaceAll('(9)', '')
        .replaceAll('(10)', '')
      ;
      navigator.clipboard.writeText(text.substring(0, text.length));
    }
  </script>
<style>code[class*=language-]{color:#555;background:none;text-shadow:0 1px white;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}.imageblock{text-align:center}h1{font-weight:100}h1{font-size:35px;line-height:38px}.dm-block--blog{width:100%;background-color:#eceff1;color:#424242;padding:0;margin:0}.dm-block--blog a,.dm-block--blog a:hover,.dm-block--blog a:visited{font-weight:700;color:#424242;text-decoration:none;cursor:pointer}.dm-block--blog a:hover{color:#424242;text-decoration:underline}.btn-copy-code{background-color:#fff;border:2px solid white;border-radius:24px;color:#424242!important;margin:1em .5em auto auto;font-weight:700;font-size:16px;display:block;cursor:pointer;width:auto;text-align:center;box-shadow:0 4px 5px #00000024,0 1px 10px #0000001f,0 2px 4px -1px #0003;padding:4px;font-size:small}.btn-copy-code:hover{background-color:#424242;border:2px solid #424242;color:#fff!important;padding:.5em 1em}footer{background-color:#424242}.is-small-screen{display:none}.is-large-screen{display:inherit}@media screen and (max-width: 900px){.is-small-screen{display:inherit}.is-large-screen{display:none}}h1{color:#424242;font-weight:100}h1{font-weight:bolder;font-size:35px;line-height:38px}@media (max-width: 700px){h1{font-size:28px;line-height:30px}}
</style><link rel="stylesheet" href="styles-2TVDB7GC.css" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-2TVDB7GC.css"></noscript><style ng-app-id="ng">.dm_footer[_ngcontent-ng-c2660501952]{color:#eee;display:flex;justify-content:space-between;font-size:14px}.dm_footer[_ngcontent-ng-c2660501952]   .dm_society[_ngcontent-ng-c2660501952]{color:#fff}.dm_footer[_ngcontent-ng-c2660501952]   div[_ngcontent-ng-c2660501952]{margin-right:1em;width:100%}.dm_footer[_ngcontent-ng-c2660501952]   .dm_footer__middle[_ngcontent-ng-c2660501952]{flex-grow:1}.dm_footer[_ngcontent-ng-c2660501952]   .dm_footer__right[_ngcontent-ng-c2660501952]{text-align:right}.dm_footer[_ngcontent-ng-c2660501952]   .is-large-screen[_ngcontent-ng-c2660501952]{padding:.7em;margin:.7em 1em}.dm_footer[_ngcontent-ng-c2660501952]   .is-small-screen[_ngcontent-ng-c2660501952]{padding:0;margin:0 1em;font-size:12px}</style><style ng-app-id="ng">h1{margin-top:.5em}.dm-blog--info-date{font-size:smaller;color:#424242;border:1px solid #aaa;border-radius:24px;padding:.5em 1em;margin-right:.5em;display:inline}.blog-keywords{display:flex;margin-bottom:1em}.blog-keywords .dm-blog--keyword-detail{background-color:#ccc;color:#424242;padding:.5em 1em;margin-right:.5em;border-radius:24px;font-size:smaller}.toc{background-color:#ccc;margin-top:1em;border:1px solid #ccc;padding:1em;border-radius:8px}.toc #toctitle{font-weight:700;margin-bottom:.5em}img{max-width:100%;height:auto}.imageblock>.content{display:flex;justify-content:center;align-items:center}.highlight{display:block;overflow-x:auto;background:#f3f3f3;color:#444;padding:1.5em;box-shadow:0 8px 16px #00000026;border-radius:8px}code.hljs{padding:3px 5px}.hljs-comment{color:#697070}.hljs-punctuation,.hljs-tag{color:#444a}.hljs-tag .hljs-attr,.hljs-tag .hljs-name{color:#444}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-operator,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#ab5656}.hljs-literal{color:#695}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta .hljs-string{color:#38a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.language-kotlin:before{display:block;float:right;content:"kotlin";font-weight:700;text-transform:uppercase}.language-typescript:before{display:block;float:right;content:"typescript";font-weight:700;text-transform:uppercase}.language-java:before{display:block;float:right;content:"java";font-weight:700;text-transform:uppercase}.language-javascript:before{display:block;float:right;content:"javascript";font-weight:700;text-transform:uppercase}.language-shell:before{display:block;float:right;content:"shell";font-weight:700;text-transform:uppercase}.language-yaml:before{display:block;float:right;content:"yaml";font-weight:700;text-transform:uppercase}.language-json:before{display:block;float:right;content:"json";font-weight:700;text-transform:uppercase}.language-xml:before{display:block;float:right;content:"xml";font-weight:700;text-transform:uppercase}.language-html:before{display:block;float:right;content:"html";font-weight:700;text-transform:uppercase}.language-css:before{display:block;float:right;content:"css";font-weight:700;text-transform:uppercase}.language-scss:before{display:block;float:right;content:"scss";font-weight:700;text-transform:uppercase}
</style></head>
<body><!--nghm-->
  <app-root _nghost-ng-c582792440 ng-version="18.0.0" ngh="2" ng-server-context="ssg"><app-header _ngcontent-ng-c582792440 _nghost-ng-c2882497807 ngh="0"><header _ngcontent-ng-c2882497807><div _ngcontent-ng-c2882497807 class="header-img"><a _ngcontent-ng-c2882497807 routerlink="/" aria-label="Accueil" href="/"><img _ngcontent-ng-c2882497807 src="img/logo/logo_long.svg" alt="Dev-Mind" title="Dev-Mind"></a></div><nav _ngcontent-ng-c2882497807><a _ngcontent-ng-c2882497807 routerlink="/" aria-label="Accueil" class="nav-home" href="/"><img _ngcontent-ng-c2882497807 src="/img/ic_home_white_24px.svg" rel="start" alt="Accueil"></a><a _ngcontent-ng-c2882497807 routerlink="/formations.html" aria-label="Formations" class href="/formations.html"> Formations</a><a _ngcontent-ng-c2882497807 routerlink="/blog.html" aria-label="Blog" class="active" href="/blog.html">Blog</a><a _ngcontent-ng-c2882497807 routerlink="/experience.html" aria-label="Experience" class href="/experience.html"> Expérience</a></nav><hr _ngcontent-ng-c2882497807></header><div _ngcontent-ng-c2882497807 class="header-space"></div></app-header><router-outlet _ngcontent-ng-c582792440></router-outlet><app-asciidoc-viewer ngh="1"><div class="dm-block--blog"><div class="devmind-section"><h1><!--ngetn--></h1><div class="blog-keywords"><div class="dm-blog--info-date">29/01/2016</div><div class="dm-blog--keyword-detail">Java</div><!---->&nbsp; </div><div class="preview"><div class="paragraph">
<p>Depuis que j’ai découvert Slack, j’ai migré beaucoup de mes flux de mails vers cet outil. Au niveau de nos applications nous pouvons aussi avoir besoin de centraliser des notifications dans cet outil. Nous allons voir comment utiliser l’API  Incoming WebHooks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2016/slack_01.png" alt="Slack">
</div>
</div>
<div class="paragraph">
<p>Le principe est très simple. Connectez vous à votre compte Slack et en allant sur <a href="https://my.slack.com/services/new/incoming-webhook/" class="bare">https://my.slack.com/services/new/incoming-webhook/</a> vous pourrez accéder à une liste des différents channels auxquelles vous êtes abonnés.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2016/slack_02.png" alt="Slack">
</div>
</div>
<div class="paragraph">
<p>Une fois fois que vous avez choisi votre channel, Slack vous génère les tokens vous permettant d’utiliser leurs API. Par exemple vous obtiendrez une URL du type <a href="https://hooks.slack.com/services/DSFDSFSDF/QSDQSDSQD/DFSDFdfkslksdDSF" class="bare">https://hooks.slack.com/services/DSFDSFSDF/QSDQSDSQD/DFSDFdfkslksdDSF</a></p>
</div>
<div class="paragraph">
<p>Plusieurs exemples de messages sont fournis. Le payload ci dessous permet par exemple d’envoyer dans le channel « général »</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" id="1734011714246.7554">payload={
    <span class="hljs-string">"channel"</span>: <span class="hljs-string">"#general"</span>,
    <span class="hljs-string">"username"</span>: <span class="hljs-string">"Dev-Mind"</span>, <span class="hljs-string">"text"</span>:
    <span class="hljs-string">"This is my post to #general."</span>,
    <span class="hljs-string">"icon_emoji"</span>: <span class="hljs-string">":ghost:"</span>
}</code><button class="btn-copy-code" onclick="copyToClipboard('1734011714246.7554')">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Vous pouvez utiliser un outil comme <a href="https://curl.haxx.se/">CURL</a> pour pousser vos messages</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" id="1734011714246.899">curl -X POST --data-urlencode 'payload={"channel": "#general", "username": "webhookbot", "text": "This is posted to #general and comes from a bot named webhookbot.", "icon_emoji": ":ghost:"}' https://hooks.slack.com/services/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</code><button class="btn-copy-code" onclick="copyToClipboard('1734011714246.899')">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Et il existe de nombreuses librairies externes pour les différents langages <a href="https://api.slack.com/community" class="bare">https://api.slack.com/community</a> mais pour un beoin aussi simple on peut se poser la question de l’intérêt d’utiliser une librairie externe.</p>
</div>
<div class="paragraph">
<p>Regardons comment créer une application Java pour envoyer des informations dans Slack. Nous allons le faire dans une application Spring Boot. Pour démarrer un nouveau projet vous pouvez aller sur <a href="http://javamind-fr.blogspot.fr/2016/01/demarrer-une-application-springboot.html">mon article</a> sur le sujet.</p>
</div>
<div class="paragraph">
<p>Le but est de démarrer le projet <a href="https://github.com/Dev-Mind/devmind-slack">devmind-slack</a> qui est un projet que vous pouvez récupérer sur Github si vous voulez voir les sources directement.</p>
</div>
<div class="paragraph">
<p>Nous allonc commencer par créer un DTO contenant les différentes informations que nous pouvons envoyer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" id="1734011714247.57"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlackMessage</span> {

    <span class="hljs-keyword">private</span> String channel;
    <span class="hljs-keyword">private</span> String text;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String icon_emoji;
    <span class="hljs-keyword">private</span> String icon_url;

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getChannel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> channel;
    }

    <span class="hljs-keyword">public</span> SlackMessage <span class="hljs-title function_">setChannel</span><span class="hljs-params">(String channel)</span> {
        <span class="hljs-built_in">this</span>.channel = <span class="hljs-string">"#"</span> + channel;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> username;
    }

    <span class="hljs-keyword">public</span> SlackMessage <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-built_in">this</span>.username = username;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getText</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> text;
    }

    <span class="hljs-keyword">public</span> SlackMessage <span class="hljs-title function_">setText</span><span class="hljs-params">(String text)</span> {
        <span class="hljs-built_in">this</span>.text = text;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getIcon_emoji</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> icon_emoji;
    }

    <span class="hljs-keyword">public</span> SlackMessage <span class="hljs-title function_">setIcon_emoji</span><span class="hljs-params">(String icon_emoji)</span> {
        <span class="hljs-built_in">this</span>.icon_emoji = <span class="hljs-string">":"</span> + icon_emoji + <span class="hljs-string">":"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getIcon_url</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> icon_url;
    }

    <span class="hljs-keyword">public</span> SlackMessage <span class="hljs-title function_">setIcon_url</span><span class="hljs-params">(String icon_url)</span> {
        <span class="hljs-built_in">this</span>.icon_url = icon_url;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }
}</code><button class="btn-copy-code" onclick="copyToClipboard('1734011714247.57')">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Le but est de coller à l’API <a href="https://api.slack.com/methods/chat.postMessage" class="bare">https://api.slack.com/methods/chat.postMessage</a></p>
</div>
<div class="paragraph">
<p>Il ne nous reste plus qu’à écrire le code qui va interagir avec le service distant et générer le payload attendu. La petite spécificité est que le format des données attendu doit être encodé</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" id="1734011714248.4978"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlackMessageSender</span> {

    <span class="hljs-meta">@Value("${slack.services.incoming}")</span>
    <span class="hljs-keyword">private</span> String slackServiceIncomingUrl;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;


    <span class="hljs-meta">@RequestMapping(value = "/slack/{message}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity<span class="hljs-meta">&lt;String</span><span class="hljs-meta">&gt;</span> hello(<span class="hljs-meta">@PathVariable(value = "message")</span> String message)
                <span class="hljs-keyword">throws</span> JsonProcessingException {

        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();

        <span class="hljs-type">SlackMessage</span> <span class="hljs-variable">slackMessage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SlackMessage</span>()
                .setChannel(<span class="hljs-string">"random"</span>)
                .setText(message)
                .setUsername(<span class="hljs-string">"guillaume"</span>)
                .setIcon_url(<span class="hljs-string">"http://dev-mind.fr/logo/logo_48.png"</span>);

        <span class="hljs-keyword">try</span>{
            <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
            headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
            HttpEntity<span class="hljs-meta">&lt;String</span><span class="hljs-meta">&gt;</span> request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span><span class="hljs-meta">&lt;</span><span class="hljs-meta">&gt;(objectMapper.writeValueAsString(slackMessage), headers)</span>;
            restTemplate.exchange(slackServiceIncomingUrl, HttpMethod.POST, request, String.class);
        }
        <span class="hljs-keyword">catch</span> (RuntimeException e){
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(e.getMessage());
        }
        <span class="hljs-keyword">return</span> ResponseEntity.ok().body(<span class="hljs-string">"Message sent"</span>);
    }
}</code><button class="btn-copy-code" onclick="copyToClipboard('1734011714248.4978')">Copy</button></pre>
</div>
</div>
<div class="paragraph">
<p>Voila vous pouvez dès à présent envoyer encore plus d’infos vers vos channels favoris</p>
</div></div></div></div></app-asciidoc-viewer><!----><app-footer _ngcontent-ng-c582792440 _nghost-ng-c2660501952 ngh="0"><footer _ngcontent-ng-c2660501952><div _ngcontent-ng-c2660501952 class="dm_footer"><div _ngcontent-ng-c2660501952 class="is-small-screen"><p _ngcontent-ng-c2660501952 id="footer-dm_society"> SARL au capital de <i _ngcontent-ng-c2660501952>5000€</i><br _ngcontent-ng-c2660501952> SIREN : 808 720 759, au RCS de Saint-Etienne<br _ngcontent-ng-c2660501952> All right reserved - ©2024 Guillaume EHRET </p></div><div _ngcontent-ng-c2660501952 class="is-large-screen"><div _ngcontent-ng-c2660501952 class="dm_footer__middle"><div _ngcontent-ng-c2660501952 class="dm_society"> Dev-Mind </div><div _ngcontent-ng-c2660501952>SARL au capital de <i _ngcontent-ng-c2660501952>5000€</i></div><div _ngcontent-ng-c2660501952>SIREN : 808 720 759, au RCS de Saint-Etienne</div><div _ngcontent-ng-c2660501952><small _ngcontent-ng-c2660501952>Mise à jour le 12/12/2024</small></div></div><div _ngcontent-ng-c2660501952 class="dm_footer__right"> All right reserved - ©2024 Guillaume EHRET </div></div></div></footer></app-footer></app-root>

<script src="polyfills-A7MJM4D4.js" type="module"></script><script src="main-IS3IYFBN.js" type="module"></script>

<script id="ng-state" type="application/json">{"__nghData__":[{},{"t":{"7":"t1"},"c":{"7":[{"i":"t1","r":1}]}},{"c":{"1":[{"i":"c490234363","r":1}]}}]}</script></body></html>