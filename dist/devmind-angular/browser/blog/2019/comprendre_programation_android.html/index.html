<!DOCTYPE html><html lang="en" data-critters-container><head>
  <meta charset="utf-8">
  <title>Blog</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      min-height: 100vh;
      max-height: 100vh;
      font-family: "Helvetica", "Arial", "sans-serif";
      padding: 0;
      margin: 0;
    }

    header {
      height: 90px;
      max-height: 90px;
      box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      background-color: white;
      display: -webkit-flex;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      z-index: 99;
      transition-duration: 0.2s;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-property: max-height, box-shadow;
      position: fixed;
      width: 100%;
      text-align: center;
    }
    header hr {
      width:100%;
      background-color: #424242;
      border-color: #424242;
      display: block;
      border: 0;
      height: 0.5em;
      margin: 0;
    }
    .header-img {
      margin: auto;
      width: 50%;
      padding-top: 0.5em;
      height: 30px;
    }
    .header-img img {
      max-height: 30px !important;
    }
    .header-space {
      min-height: 90px;
    }


    @media screen and (min-width: 901px) {
      header {
        height: 120px;
        max-height: 120px;
      }
      .header-img {
        height: 60px;
      }
      .header-img img {
        max-height: 60px !important;
      }
      .header-space {
        min-height: 120px;
      }
      nav a {
        padding: 6px 24px;
      }
      .nav-home{
        display: block !important;
      }
    }


    nav {
      display: -webkit-flex;
      display: flex;
      margin: auto;
    }

    nav a {
      padding: 0 12px;
      line-height: 28px;
      height: 28px;
      color: #424242;
      margin: auto;
      text-decoration: none;
      text-transform: uppercase;
      font-weight: 600;
      font-size: 13px;
      border-radius: 4px;
    }
    .nav-home{
      display: none;
    }
    nav a > img {
    // height: 20px;
    }

    nav a:hover {
      background-color: #9e9e9e;
    }

    nav .active {
      background-color: rgba(0, 0, 0, 0.14);
    }

    main {
      overflow-x: hidden;
    }

    img, picture {
      max-width: 100%;
      height: auto;
      margin: auto;
    }

    * {
      box-sizing: border-box; /* pour maîtriser width et flex-basis */
    }

    .devmind-section {
      display: block;
      margin: 0 auto;
      max-width: 1600px;
      padding: 60px 40px;
    }

    @media (max-width: 700px) {
      .devmind-section {
        padding: 25px 10px;
      }
    }

    @media (min-width: 701px) and (max-width: 900px) {
      .devmind-section {
        padding: 40px 25px;
      }
    }

    .dm-social {
      min-width: 2em;
      max-width: 2em;
      width: 2em;
      height: 2em;
    }
  </style>
  <script>
    function copyToClipboard(id) {
      const text = document.getElementById(id).innerText
        .replaceAll('~$', '')
        .replaceAll('(1)', '')
        .replaceAll('(2)', '')
        .replaceAll('(3)', '')
        .replaceAll('(4)', '')
        .replaceAll('(5)', '')
        .replaceAll('(6)', '')
        .replaceAll('(7)', '')
        .replaceAll('(8)', '')
        .replaceAll('(9)', '')
        .replaceAll('(10)', '')
      ;
      navigator.clipboard.writeText(text.substring(0, text.length));
    }
  </script>
<style>.imageblock,.imageblock .title{text-align:center}.toc{background:#f0f8ff;padding:1em}h1,h2{font-weight:100}h1{font-size:35px;line-height:38px}.dm-block--blog{width:100%;background-color:#eceff1;color:#424242;padding:0;margin:0}.dm-block--blog a,.dm-block--blog a:hover,.dm-block--blog a:visited{font-weight:700;color:#424242;text-decoration:none;cursor:pointer}.dm-block--blog a:hover{color:#424242;text-decoration:underline}.dm-block--blog .link{display:block}footer{background-color:#424242}.is-small-screen{display:none}.is-large-screen{display:inherit}@media screen and (max-width: 900px){.is-small-screen{display:inherit}.is-large-screen{display:none}}h1,h2{color:#424242;font-weight:100}h1{font-weight:bolder;font-size:35px;line-height:38px}h2{font-size:25px;line-height:28px}@media (max-width: 700px){h1{font-size:28px;line-height:30px}h2{font-size:22px;line-height:24px}}
</style><link rel="stylesheet" href="styles-2TVDB7GC.css" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-2TVDB7GC.css"></noscript><style ng-app-id="ng">.dm_footer[_ngcontent-ng-c2660501952]{color:#eee;display:flex;justify-content:space-between;font-size:14px}.dm_footer[_ngcontent-ng-c2660501952]   .dm_society[_ngcontent-ng-c2660501952]{color:#fff}.dm_footer[_ngcontent-ng-c2660501952]   div[_ngcontent-ng-c2660501952]{margin-right:1em;width:100%}.dm_footer[_ngcontent-ng-c2660501952]   .dm_footer__middle[_ngcontent-ng-c2660501952]{flex-grow:1}.dm_footer[_ngcontent-ng-c2660501952]   .dm_footer__right[_ngcontent-ng-c2660501952]{text-align:right}.dm_footer[_ngcontent-ng-c2660501952]   .is-large-screen[_ngcontent-ng-c2660501952]{padding:.7em;margin:.7em 1em}.dm_footer[_ngcontent-ng-c2660501952]   .is-small-screen[_ngcontent-ng-c2660501952]{padding:0;margin:0 1em;font-size:12px}</style><style ng-app-id="ng">h1{margin-top:.5em}.dm-blog--info-date{font-size:smaller;color:#424242;border:1px solid #aaa;border-radius:24px;padding:.5em 1em;margin-right:.5em;display:inline}.blog-keywords{display:flex;margin-bottom:1em}.blog-keywords .dm-blog--keyword-detail{background-color:#ccc;color:#424242;padding:.5em 1em;margin-right:.5em;border-radius:24px;font-size:smaller}.toc{background-color:#ccc;margin-top:1em;border:1px solid #ccc;padding:1em;border-radius:8px}.toc #toctitle{font-weight:700;margin-bottom:.5em}img{max-width:100%;height:auto}.imageblock>.content{display:flex;justify-content:center;align-items:center}.highlight{display:block;overflow-x:auto;background:#f3f3f3;color:#444;padding:1.5em;box-shadow:0 8px 16px #00000026;border-radius:8px}code.hljs{padding:3px 5px}.hljs-comment{color:#697070}.hljs-punctuation,.hljs-tag{color:#444a}.hljs-tag .hljs-attr,.hljs-tag .hljs-name{color:#444}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-operator,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#ab5656}.hljs-literal{color:#695}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta .hljs-string{color:#38a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.language-kotlin:before{display:block;float:right;content:"kotlin";font-weight:700;text-transform:uppercase}.language-typescript:before{display:block;float:right;content:"typescript";font-weight:700;text-transform:uppercase}.language-java:before{display:block;float:right;content:"java";font-weight:700;text-transform:uppercase}.language-javascript:before{display:block;float:right;content:"javascript";font-weight:700;text-transform:uppercase}.language-shell:before{display:block;float:right;content:"shell";font-weight:700;text-transform:uppercase}.language-yaml:before{display:block;float:right;content:"yaml";font-weight:700;text-transform:uppercase}.language-json:before{display:block;float:right;content:"json";font-weight:700;text-transform:uppercase}.language-xml:before{display:block;float:right;content:"xml";font-weight:700;text-transform:uppercase}.language-html:before{display:block;float:right;content:"html";font-weight:700;text-transform:uppercase}.language-css:before{display:block;float:right;content:"css";font-weight:700;text-transform:uppercase}.language-scss:before{display:block;float:right;content:"scss";font-weight:700;text-transform:uppercase}
</style></head>
<body><!--nghm-->
  <app-root _nghost-ng-c582792440 ng-version="18.0.0" ngh="2" ng-server-context="ssg"><app-header _ngcontent-ng-c582792440 _nghost-ng-c2882497807 ngh="0"><header _ngcontent-ng-c2882497807><div _ngcontent-ng-c2882497807 class="header-img"><a _ngcontent-ng-c2882497807 routerlink="/" aria-label="Accueil" href="/"><img _ngcontent-ng-c2882497807 src="img/logo/logo_long.svg" alt="Dev-Mind" title="Dev-Mind"></a></div><nav _ngcontent-ng-c2882497807><a _ngcontent-ng-c2882497807 routerlink="/" aria-label="Accueil" class="nav-home" href="/"><img _ngcontent-ng-c2882497807 src="/img/ic_home_white_24px.svg" rel="start" alt="Accueil"></a><a _ngcontent-ng-c2882497807 routerlink="/formations.html" aria-label="Formations" class href="/formations.html"> Formations</a><a _ngcontent-ng-c2882497807 routerlink="/blog.html" aria-label="Blog" class="active" href="/blog.html">Blog</a><a _ngcontent-ng-c2882497807 routerlink="/experience.html" aria-label="Experience" class href="/experience.html"> Expérience</a></nav><hr _ngcontent-ng-c2882497807></header><div _ngcontent-ng-c2882497807 class="header-space"></div></app-header><router-outlet _ngcontent-ng-c582792440></router-outlet><app-asciidoc-viewer ngh="1"><div class="dm-block--blog"><div class="devmind-section"><h1><!--ngetn--></h1><div class="blog-keywords"><div class="dm-blog--info-date">12/06/2019</div><div class="dm-blog--keyword-detail">Android</div><!---->&nbsp; </div><div class="preview"><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a class="link" fragment="#_ecosystème_android">Ecosystème Android</a>
<ul class="sectlevel2">
<li><a class="link" fragment="#_android_los_le_plus_utilisé">Android l’OS le plus utilisé</a></li>
<li><a class="link" fragment="#_principe_de_la_programmation_mobile">Principe de la programmation mobile</a></li>
</ul>
</li>
<li><a class="link" fragment="#_plateforme_android">Plateforme Android</a>
<ul class="sectlevel2">
<li><a class="link" fragment="#_noyau_linux">Noyau Linux</a></li>
<li><a class="link" fragment="#_couche_dabstraction_hardware">Couche d’abstraction hardware</a></li>
<li><a class="link" fragment="#_langages_de_programmation">Langages de programmation</a></li>
<li><a class="link" fragment="#_sécurité">Sécurité</a></li>
</ul>
</li>
<li><a class="link" fragment="#_la_fragmentation">La fragmentation</a>
<ul class="sectlevel2">
<li><a class="link" fragment="#_fragmentation_au_niveau_des_versions">Fragmentation au niveau des versions</a></li>
<li><a class="link" fragment="#_fragmentation_au_niveau_des_écrans">Fragmentation au niveau des écrans</a></li>
<li><a class="link" fragment="#_fragmentation_au_niveau_matériel">Fragmentation au niveau matériel</a></li>
</ul>
</li>
<li><a class="link" fragment="#_conclusion">Conclusion</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Mon objectif est de vous montrer comment développer une application Android de A à Z en utilisant les dernières préconisations de Google. Il y a beaucoup de choses à écrire sur le sujet et je le ferai dans plusieurs articles. Dans cette première partie nous allons parler de l’écosystème Android et de la plateforme : chose essentielle si vous voulez comprendre les spécificités du développement Android.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_pf_00.png" alt="Comprendre la programmation Android">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ecosystème_android">Ecosystème Android</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_android_los_le_plus_utilisé">Android l’OS le plus utilisé</h3>
<div class="paragraph">
<p>Il y a deux acteurs majeurs dans le monde du mobile : Apple (<a href="https://www.apple.com/fr/ios/">iOS</a>) et Google (<a href="https://www.android.com/">Android</a>). Android est aujourd’hui l’OS sur mobile le plus utilisé dans le monde. Près de 70% des utilisateurs dans les pays occidentaux utilisent cette plateforme. En Afrique ou en Asie, la politique tarifaire d’Apple, fait que les parts de marché Android sont encore plus fortes et continuent à grimper.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_eco_01.png" alt="Répartition des OS mobiles">
</div>
<div class="title">Répartition des OS mobiles (source statscounter 2019)</div>
</div>
<div class="paragraph">
<p>Faire de la programmation mobile a un intérêt. L’accès à l’informatique (web ou autre) se fait de plus en plus avec des mobiles et tablettes. Android est devenu l’OS le plus utilisé au niveau mondial tout systême confondu</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_eco_03.png" alt="Desktop vs mobile">
</div>
<div class="title">Répartition mobile vs desktop (source statscounter 2019)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_eco_02.png" alt="Répartition des OS">
</div>
<div class="title">Répartition des OS (source statscounter 2019)</div>
</div>
</div>
<div class="sect2">
<h3 id="_principe_de_la_programmation_mobile">Principe de la programmation mobile</h3>
<div class="paragraph">
<p>La mobilité a transformé les devices que nous utilisons. Quand vous êtes sur un PC fixe ou un portable vous avez toujours à peu près les mêmes composants : CPU, carte graphique, disque dur, lecteur carte photo, ports d’entrée/sortie. Sur un mobile vous allez avoir plus de composants pour vous aider dans ce contexte de mobilité : GPS, caméra, appareil photo, accélomètre, podomètre…​ Nous avons de plus en plus de capteurs pour interpréter le contexte d’utilisation du device</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_eco_04.png" alt="Capteurs des devices mobiles">
</div>
<div class="title">Capteurs des devices mobiles</div>
</div>
<div class="paragraph">
<p>La spécificité de la programmation mobile, est de proposer des applications qui récupérent et aggrègent les données émises par les différents capteurs pour répondre à un besoin utilisateur. Quand vous voulez vous interfacer avec ces capteurs, apporter de la réactivité dans vos application, le développement natif est la solution.</p>
</div>
<div class="paragraph">
<p>Créer une application mobile pour simplement afficher du contenu statique n’a pas de sens. Pour ce besoin, on préférera les applications web responsives (PWA) qui sont beaucoup plus optimales et moins coûteuses. Une application native doit être dynamique et profiter des API et des capteurs exposés par les devices.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plateforme_android">Plateforme Android</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voici une image simplifiée de la plateforme Android</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_pf_01.png" alt="Android se base sur Linux">
</div>
</div>
<div class="sect2">
<h3 id="_noyau_linux">Noyau Linux</h3>
<div class="paragraph">
<p>Android a été construit sur un <a href="https://www.kernel.org/">noyau Linux</a>. Mais Android n’est pas totalement Open Source. Seule une <a href="https://source.android.com/">partie</a> est libre de droit.</p>
</div>
<div class="paragraph">
<p>Android s’appuie sur les forces de Linux pour fournir un OS stable et fiable : gestion de la mémoire, gestion des processus, sécurité…​</p>
</div>
</div>
<div class="sect2">
<h3 id="_couche_dabstraction_hardware">Couche d’abstraction hardware</h3>
<div class="paragraph">
<p>Android définit une couche abstraite pour s’interfacer avec les différents capteurs ou élements de bas niveau d’un device :  HAL (Hardware Abstraction Layer). Les différents constructeurs de mobile doivent implémenter cette couche pour que leur téléphone puisse fonctionner. Ils doivent également prouver que leurs téléphones sont capables de répondre aux exigences de tests demandées par Google. Il existe des tests de compatibilités avec une version de l’OS (<a href="https://source.android.com/compatibility/cts">CTS compatibility test suite</a>) et des d’autres tests complémentaires (<a href="https://source.android.com/compatibility/vts">VTS Vendor test suite</a>).</p>
</div>
<div class="paragraph">
<p>Ces développements peuvent être longs et coûteux. C’est pour cette raison, que les constructeurs ne font pas évoluer leurs téléphones. Leur but est de vendre toujours plus de nouveaux devices, et non de maintenir les anciens. Ces problèmes de mises à jour entraînent une grosse fragmentation dans l’utilisation des versions de l’OS. Cette fragmentation liée aux versions du système d’exploitation, est moins présente dans le monde iOS. Comme Apple est à la fois éditeur et constructeur, tout est fait pour que chaque nouvelle version soit supportée par les anciens devices (troll: sauf quand ils introduident de l’obsolescence programmée).</p>
</div>
</div>
<div class="sect2">
<h3 id="_langages_de_programmation">Langages de programmation</h3>
<div class="paragraph">
<p>Le coeur d’Android est écrit en <a href="http://www.open-std.org/jtc1/sc22/wg21/">C ou C++</a> et plusieurs librairies natives sont accessibles (<a href="https://developer.android.com/ndk/">NDK Native development kit</a>). Vous pouvez écrire vos applications en C mais pour faciliter la mise en place d’applications, Google a poussé les développeurs à utiliser le langage Java depuis les débuts. Java est parfois verbeux mais il a l’avantage d’être simple et d’amener un cadre de développement.</p>
</div>
<div class="sect3">
<h4 id="_machine_virtuelle">Machine virtuelle</h4>
<div class="paragraph">
<p>Android propose donc une machine virtuelle pour exécuter du bytecode. Ce n’est pas une JVM classique. Les ingénieurs de chez Google ont essayé de travailler sur un bytecode avec une plus faible empreinte mémoire. En Android le compilateur va créer des fichier .dex (Dalvik executable). <a href="https://javamind-fr.blogspot.com/2012/10/dalvik-la-vm-android.html">Dalvik</a> était le premier compilateur utilisé sur la plateforme. Comme les JVM actuelles, Dalvik transformait le bytecode en langage machine à l’exécution : compilation Just In Time (JIT).</p>
</div>
<div class="paragraph">
<p>Aujourd’hui cette machine virtuelle a été remplacée par <a href="http://javamind-fr.blogspot.com/2014/06/art-nouvelle-machine-virtuelle-java.html">ART (Android Runtime)</a>. La transformation en langage machine est faite à l’installation de l’application : compilation AOT (ahead of time). Comme le bytecode est compilé plus tôt en langage machine, les applications se lancent plus vite et le CPU est moins solliciter lors de l’exécution (et donc préservation de votre batterie).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_pf_02.png" alt="Android compilation">
</div>
</div>
<div class="paragraph">
<p>J’ai volontairement fait un abus de langage en indiquant que le bytecode était transformé en langage machine. Ce n’est pas vraiment le cas. Si nous avions vraiment du langage machine nous n’aurions plus besoin de VM. En fait à l’installation le bytecode est transformé en un format intermédiaire : fichiers .oat (ahead of time). La VM est nécessaire car elle va gérer les allocations mémoires et la libération de l’espace avec le Garbage collector. Même si la compilation n’est plus Just In Time, des optimisations sont toujours faites à l’exécution pour que le code s’exécute le plus vite possible.</p>
</div>
<div class="paragraph">
<p>Vous trouverez plus d’informations dans la <a href="https://source.android.com/devices/tech/dalvik/index.html">documentation</a>.</p>
</div>
<div class="paragraph">
<p>Toutes ces adaptations par rapport à une machine virtuelle Java sont au coeur du procès entre Google et Oracle. Oracle n’a pas racheté Java à Sun pour se lancer dans l’Open Source. Ils l’ont surtout racheté en pensant faire payer des licences à Google pour chaque appareil vendus. Cette guerre commerciale est en train à mon sens de tuer l’utilisation de Java sur la plateforme. Mais pour une fois c’est aussi dans l’intérêt des développeurs car l’aspect financier a certainement été un catalyseur pour l’adoption de Kotlin.</p>
</div>
</div>
<div class="sect3">
<h4 id="_langage_kotlin">Langage Kotlin</h4>
<div class="paragraph">
<p>En 2017 une grande annonce a été faite à Google IO. Le langage <a href="https://kotlinlang.org/">Kotlin</a> devenait le deuxième langage de référence pour développer des applications. 2 ans après 50% des développeurs utilisent Kotlin et Google a <a href="https://android-developers.googleblog.com/2019/05/google-io-2019-empowering-developers-to-build-experiences-on-Android-Play.html">annoncé à Google I/O 2019</a> que la plateforme devenait Kotlin-first. Ils préconisent de démarrer les nouveaux développements en Kotlin.</p>
</div>
<div class="paragraph">
<p>Si vous voulez en savoir plus sur le langage Kotlin et les avantages à l’utiliser sur la plateforme Android, vous pouvez lire <a href="https://dev-mind.fr/blog/2019/kotlin_et_android.html">mon article</a> sur le sujet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_studio_de_développement">Studio de développement</h4>
<div class="paragraph">
<p>Initialement le studio de développement préconisé était Eclipse mais plus les fonctionnalités s’enrichissaient, plus l’IDE était long et devenait inutilisable. Google a donc travaillé en partenariat avec <a href="https://www.jetbrains.com/">JetBrains</a> (éditeur de Webstorm, IntelliJ, Kotlin) pour adapter leur version Open Source et créer <a href="https://developer.android.com/studio/">Android Studio</a>.</p>
</div>
<div class="paragraph">
<p>Vous trouverez à l’intérieur de cet IDE toutes les fonctionnalités nécéssaires aux développements. Vous avez des utilitaires pour</p>
</div>
<div class="ulist">
<ul>
<li>
<p>vérifier votre code</p>
</li>
<li>
<p>gérer les différentes versions du SDK Android</p>
</li>
<li>
<p>lancer un device virtuel sur votre machine pour tester manuellement ou automatiquement votre code</p>
</li>
<li>
<p>monitorer et debugguer votre application</p>
</li>
<li>
<p>packager votre application afin de la publier sur le store Google</p>
</li>
<li>
<p>…​</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sécurité">Sécurité</h3>
<div class="paragraph">
<p>Comme Android est basé sur un noyau Linux, la plateforme bénéficie de la sécurité implémentée au niveau du noyau.</p>
</div>
<div class="paragraph">
<p>Quand une application est installée, Android lui assigne un user ID. Chaque application est lancée dans un processus séparé et utilise sa propre instance d’ART (machine virtuel). Les droits d’exécution sont propres à cet utilisateur applicatif. L’application n’a pas de notion de cet ID. Ainsi une application ne peut pas accéder aux données d’une autre application car tout est bouclé par cet artifice. C’est la même chose pour les applications natives.</p>
</div>
<div class="paragraph">
<p>Chaque application est donc isolée des autres et possèdent ses propres ressources CPU, mémoire…​.</p>
</div>
<div class="paragraph">
<p>Au dessus de cette sécurité "bas niveau", Android a ajouté au fil du temps un niveau de sécurité plus "haut niveau". Chaque action externe pouvant être demandée par votre application doit être déclarée dans un fichier manifest. Par exemple</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lire les contacts,</p>
</li>
<li>
<p>prendre une photo,</p>
</li>
<li>
<p>accéder à Internet</p>
</li>
<li>
<p>…​</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un utilisateur peut choisir de laisser les droits demandés à l’installation, mais il peut aussi choisir d’enlever certains droits. Personnellement je limite le nombre d’application pouvant se connecter au réseau, pouvant utiliser mes contacts, mes fichiers…​. (sur un Android sans surcouche vous devez aller dans les paramètres dans le menu "Appli et notifications", dans les options avancées et sur l’entrée "Autorisation des applications").</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_la_fragmentation">La fragmentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La fragmentation est un réel problème sur la plateforme et en tant que développeur vous devrez faire des choix en fonction de votre cible utilisateur.</p>
</div>
<div class="paragraph">
<p>Android est un OS utilisable par n’importe quel fabricant de téléphone (on mettra à part le cas <a href="https://www.frandroid.com/marques/huawei/595661_huawei-android-google-et-les-etats-unis-toutes-les-reponses-a-vos-questions">Huawei</a>). Comme je l’ai dit plus haut, le coup pour adapter une version à un device n’est pas négligeable. C’est pour cette raison  que les constructeurs limitent ces mises à jour. Leur intérêt est de vendre de nouveaux devices et non de les maintenir.</p>
</div>
<div class="paragraph">
<p>La fragmentation n’est pas liée qu’aux versions de l’OS mais nous avons également une fragmentation liée aux devices et à leurs composants. En fonction des gammes de prix, chaque device peut avoir des caractéristiques techniques différentes.</p>
</div>
<div class="sect2">
<h3 id="_fragmentation_au_niveau_des_versions">Fragmentation au niveau des versions</h3>
<div class="paragraph">
<p>Depuis quelques années, Google sort une nouvelle version d’Android par an. Généralement les développeurs peuvent commencer à tester et faire des retours sur le second et troisième trimestre et la version est mise à disposition au dernier trimestre d’une année civile.</p>
</div>
<div class="paragraph">
<p>Chaque nouvelle version est associée à une lettre (qui s’incrémente à chaque version) et à un dessert (choisi par l’équipe Android).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_fg_01.png" alt="Versions Android">
</div>
</div>
<div class="paragraph">
<p>Vous pouvez voir que certains de ces desserts sont des desserts français. Depuis les débuts, l’équipe Android comprend plusieurs français. Vous connaissez peut être <a href="https://twitter.com/romainguy">Romain Guy</a> qui est régulièrement présent dans les conférences.</p>
</div>
<div class="paragraph">
<p>Quand vous démarrez un nouveau développement vous devez faire un choix de version. En fait vous devez faire deux choix</p>
</div>
<div class="ulist">
<ul>
<li>
<p>définir une version cible : généralement vous devez toujours choisir la dernière version de l’OS</p>
</li>
<li>
<p>définir une version minimale : vous définissez quelle est la version minimale de l’OS supportée. Le compilateur est capable de vous alertez quand vous essayez d’utiliser une API qui n’est pas supportée</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_fg_02.png" alt="Choix de la version Android">
</div>
</div>
<div class="paragraph">
<p>Les statistiques d’utilisation des versions sont publiées régulièrement sur <a href="https://developer.android.com/about/dashboards/">ce tableau de bord</a> qui compile les données remontées par Google Store (la source officielle des applications Android).</p>
</div>
<div class="paragraph">
<p>Dans le monde du web, vous pouvez utiliser des polyfills pour utiliser les dernières nouveautés du langage dans des navigateurs qui n’implémentent pas encore ces fonctionnalités. Dans le monde Android, Google vous propose aussi d’utiliser des objets particuliers qui gèrent cette rétrocompatibilité. La classe de base pour développer un écran est <code>android.app.Activity</code>, mais dans la pratique nous utiliserons toujours <code>androidx.appcompat.app.AppCompatActivity</code> qui a été développée pour porter les dernières nouveautés sur les anciennes releases Android.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fragmentation_au_niveau_des_écrans">Fragmentation au niveau des écrans</h3>
<div class="paragraph">
<p>Après les versions, la plus grosse différence entre les devices concerne la qualité et la taille de l’écran.</p>
</div>
<div class="paragraph">
<p>Pour rappel</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la <strong>résolution d’un écran</strong> représente le nombre de pixels en horizontal multiplé par le nombre de pixel en vertical. Par exemple (800 x 600)</p>
</li>
<li>
<p>la <strong>taille d’un écran</strong> est le nombre de pouce de la diagonale de l’écran</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Android propose une classification liée à la largeur d’un écran.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_fg_03.png" alt="taille ecran Android">
</div>
</div>
<div class="paragraph">
<p>Comme dans le monde du web, vous devez adpater votre UI soit en utilisant des composants et layout redimensionnable, soit en utilisant des layouts différents en fonction de la taille (en Android vous pouvez utiliser des fragments)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_fg_04.png" alt="UI flexible sous Android">
</div>
</div>
<div class="paragraph">
<p>La <strong>densité de pixels</strong> est le nombre de points par pouce (dot per inch ⇒ dpi). La densité est importante sur un device. Par exemple si vous affichez une image exprimée en pixel sur 2 écrans de densité différentes vous n’aurez pas le même rendu</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_fg_05.png" alt="Densité sous Android avec image en px">
</div>
</div>
<div class="paragraph">
<p>Si on affiche les mêmes images exprimées avec l’unité <strong>dp</strong> (density-independent pixels) vous aurez le rendu suivant</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_fg_06.png" alt="Densité sous Android avec image en dp">
</div>
</div>
<div class="paragraph">
<p>La règle est de ne <strong>jamais exprimer des tailles en px dans une application mais toujours en dp</strong> (dans le monde du web on utilisera l’unité em). Pour exprimer la taille des polices d’écriture, vous utiliserez plutôt l’unité <strong>sp</strong> (scalable pixels) qui a l’avantage de grossir en fonction des paramètres d’accessibilité utilisateur.</p>
</div>
<div class="paragraph">
<p>Vous allez pouvoir créer des ressources différentes en fonction de la taille. Quand vous avez un bel écran avec une bonne résolution, une forte densité, vous attendrez des images de qualité. Ces mêmes images n’ont aucun intérêt sur des écrans qui ne sont pas capables de les afficher.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fragmentation_au_niveau_matériel">Fragmentation au niveau matériel</h3>
<div class="paragraph">
<p>Nous nous sommes arrếtés sur les 2 plus grosses différences entre device mais on pourrait aller plus loin car vous avez aussi une grosse différence de qualité et de performances au niveau des composants de base d’un mobile ou d’une tablette. Vous n’avez pas les mêmes composants dans les devices d’entrée de gamme et ceux plus luxueux</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../img/blog/2019/android_fg_07.png" alt="Fragmentation matérielle">
</div>
</div>
<div class="paragraph">
<p>Pour offrir une bonne expérience utilisateur, vous pouvez appliquer quelques règles simples</p>
</div>
<div class="paragraph">
<p>Comme vos utilisateurs peuvent et ont pour la plupart des ressources limitées essayer de</p>
</div>
<div class="ulist">
<ul>
<li>
<p>limiter les appels réseaux qui consomment beaucoup de ressources et donc usent la batterie,</p>
</li>
<li>
<p>veiller à avoir un livrable d’une taille raisonnable. Si vous intégrez beaucoup d’images faites plusieurs archives avec des cibles différentes en fonction de la qualité des devices</p>
</li>
<li>
<p>éviter de stocker trop de données sur le téléphone de vos utilisateurs (que ce soit sur le disque ou dans la base de données partagées). Si vous devez stocker des éléments prévoyer de purger les éléments inutiles</p>
</li>
<li>
<p>privilégier des UI sombres qui préservent la batterie</p>
</li>
<li>
<p>appliquer le principe KISS (keep it simple, stupid)</p>
</li>
<li>
<p>…​</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous venons de voir comment la plateforme a été construite et les problèmes liés à la fragementation. Dans le prochain article nous rentrerons dans le concret et nous regarderons comment développer une première application Android.</p>
</div>
<div class="paragraph">
<p>Si la plateforme vous intéresse je vous conseille de suivre quelques passionnés (Googlers ou non) : <a href="https://twitter.com/chethaase">Chet Haase</a>, <a href="https://twitter.com/JakeWharton">Jake Wharton</a>, <a href="https://twitter.com/romainguy">Romain Guy</a>, <a href="https://twitter.com/cyrilmottier">Cyril Mottier</a></p>
</div>
<div class="paragraph">
<p>Si vous voulez plus d’informations vous pouvez consulter <a href="https://developer.android.com" class="bare">https://developer.android.com</a> et si vous êtes fan de podcast en français je vous conseille de suivre <a href="http://androidleakspodcast.com/" class="bare">http://androidleakspodcast.com/</a></p>
</div>
</div>
</div></div></div></div></app-asciidoc-viewer><!----><app-footer _ngcontent-ng-c582792440 _nghost-ng-c2660501952 ngh="0"><footer _ngcontent-ng-c2660501952><div _ngcontent-ng-c2660501952 class="dm_footer"><div _ngcontent-ng-c2660501952 class="is-small-screen"><p _ngcontent-ng-c2660501952 id="footer-dm_society"> SARL au capital de <i _ngcontent-ng-c2660501952>5000€</i><br _ngcontent-ng-c2660501952> SIREN : 808 720 759, au RCS de Saint-Etienne<br _ngcontent-ng-c2660501952> All right reserved - ©2024 Guillaume EHRET </p></div><div _ngcontent-ng-c2660501952 class="is-large-screen"><div _ngcontent-ng-c2660501952 class="dm_footer__middle"><div _ngcontent-ng-c2660501952 class="dm_society"> Dev-Mind </div><div _ngcontent-ng-c2660501952>SARL au capital de <i _ngcontent-ng-c2660501952>5000€</i></div><div _ngcontent-ng-c2660501952>SIREN : 808 720 759, au RCS de Saint-Etienne</div><div _ngcontent-ng-c2660501952><small _ngcontent-ng-c2660501952>Mise à jour le 14/11/2024</small></div></div><div _ngcontent-ng-c2660501952 class="dm_footer__right"> All right reserved - ©2024 Guillaume EHRET </div></div></div></footer></app-footer></app-root>

<script src="polyfills-A7MJM4D4.js" type="module"></script><script src="main-RCAYVOUE.js" type="module"></script>

<script id="ng-state" type="application/json">{"__nghData__":[{},{"t":{"7":"t1"},"c":{"7":[{"i":"t1","r":1}]}},{"c":{"1":[{"i":"c490234363","r":1}]}}]}</script></body></html>